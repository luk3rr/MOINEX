include:
  - project: 'personal/infrastructure_lives'
    file: '/pipeline/backend.yml'
    ref: main

variables:
  PROJECT_NAME: "MOINEX"

cache:
  paths:
    - ~/.m2/repository/

stages:
  - test
  - quality
  - build
  - deploy

unit_test:
  stage: test
  image: maven:3.9.6-eclipse-temurin-21
  script:
    - mvn clean install jacoco:prepare-agent install jacoco:report
    - mvn dependency:copy-dependencies
  artifacts:
    paths:
      - target/classes
      - target/dependency
      - target/site/jacoco/jacoco.xml
    when: always
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:
      - ~/.m2/repository/
    policy: pull-push
  rules:
    - if: '$CI_COMMIT_BRANCH == "main" || $CI_MERGE_REQUEST_ID'
      when: always
    - when: never
      allow_failure: false

build_migration:
  rules:
    - when: never

deploy_migration:
  rules:
    - when: never

deploy_migration_rollback:
  rules:
    - when: never

build_app:
  rules:
    - when: never

deploy_app:
  rules:
    - when: never

